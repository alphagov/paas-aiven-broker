---
platform: linux
image_resource:
  type: registry-image
  source:
    repository: ghcr.io/alphagov/paas/cf-acceptance-tests
    tag: ecdcea170f3b23f277b61041c2f870df5f71c7fd
inputs:
  - name: repo
params:
  AIVEN_API_TOKEN: ((aiven_api_token))
  AIVEN_PROJECT: ((aiven_project))
run:
  path: sh
  args:
    - -e
    - -c
    - |
      DEPLOY_ENV=test
      export DEPLOY_ENV
      BROKER_NAME=test-broker
      export BROKER_NAME
      AIVEN_USERNAME=foo
      export AIVEN_USERNAME
      AIVEN_PASSWORD=bar
      export AIVEN_PASSWORD
      AIVEN_CLOUD=aws-eu-west-1
      export AIVEN_CLOUD

      cd repo
      make integration
